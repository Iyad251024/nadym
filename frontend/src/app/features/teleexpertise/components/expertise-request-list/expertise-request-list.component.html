<div class="page-header">
  <div class="container">
    <h1>Téléexpertise</h1>
    <p>Demandes d'avis spécialisés</p>
  </div>
</div>

<div class="container">
  <!-- Quick Stats -->
  <div class="card-grid">
    <div class="stat-card">
      <h2 class="stat-number">{{ pendingRequests.length }}</h2>
      <p class="stat-label">En attente</p>
    </div>
    
    <div class="stat-card">
      <h2 class="stat-number">{{ inProgressRequests.length }}</h2>
      <p class="stat-label">En cours</p>
    </div>
    
    <div class="stat-card">
      <h2 class="stat-number">{{ completedRequests.length }}</h2>
      <p class="stat-label">Terminées</p>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button mat-raised-button color="primary" (click)="newRequest()">
      <mat-icon>add</mat-icon>
      Nouvelle demande d'expertise
    </button>
  </div>

  <!-- Expertise Request Tabs -->
  <mat-tab-group>
    <!-- Pending Requests -->
    <mat-tab label="En attente">
      <ng-template mat-tab-label>
        En attente
        <span class="badge" *ngIf="pendingRequests.length > 0">({{ pendingRequests.length }})</span>
      </ng-template>
      <div class="requests-grid">
        <mat-card *ngFor="let request of pendingRequests" class="request-card pending">
          <mat-card-header>
            <mat-icon mat-card-avatar color="accent">psychology</mat-icon>
            <mat-card-title>{{ request.patientName }}</mat-card-title>
            <mat-card-subtitle>{{ request.specialty }}</mat-card-subtitle>
            <div class="card-actions">
              <mat-chip [color]="getUrgencyColor(request.urgency)" selected>
                {{ getUrgencyLabel(request.urgency) }}
              </mat-chip>
            </div>
          </mat-card-header>
          
          <mat-card-content>
            <div class="request-info">
              <div class="info-row">
                <mat-icon>schedule</mat-icon>
                <span>{{ formatDateTime(request.requestDate) }}</span>
              </div>
              
              <div class="info-row">
                <mat-icon>info</mat-icon>
                <span>{{ getStatusLabel(request.status) }}</span>
              </div>
              
              <div class="summary">
                <p>{{ request.summary }}</p>
              </div>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="warn" (click)="cancelRequest(request)" 
                    *ngIf="canCancel(request)">
              <mat-icon>cancel</mat-icon>
              Annuler
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>

    <!-- In Progress Requests -->
    <mat-tab label="En cours">
      <ng-template mat-tab-label>
        En cours
        <span class="badge" *ngIf="inProgressRequests.length > 0">({{ inProgressRequests.length }})</span>
      </ng-template>
      <div class="requests-grid">
        <mat-card *ngFor="let request of inProgressRequests" class="request-card in-progress">
          <mat-card-header>
            <mat-icon mat-card-avatar color="primary">psychology</mat-icon>
            <mat-card-title>{{ request.patientName }}</mat-card-title>
            <mat-card-subtitle>{{ request.specialty }}</mat-card-subtitle>
            <div class="card-actions">
              <mat-chip [color]="getStatusColor(request.status)" selected>
                {{ getStatusLabel(request.status) }}
              </mat-chip>
            </div>
          </mat-card-header>
          
          <mat-card-content>
            <div class="request-info">
              <div class="info-row">
                <mat-icon>schedule</mat-icon>
                <span>{{ formatDateTime(request.requestDate) }}</span>
              </div>
              
              <div class="info-row" *ngIf="request.expertName">
                <mat-icon>person</mat-icon>
                <span>{{ request.expertName }}</span>
              </div>
              
              <div class="info-row">
                <mat-icon>priority_high</mat-icon>
                <span>Urgence: {{ getUrgencyLabel(request.urgency) }}</span>
              </div>
              
              <div class="summary">
                <p>{{ request.summary }}</p>
              </div>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button color="warn" (click)="cancelRequest(request)" 
                    *ngIf="canCancel(request)">
              <mat-icon>cancel</mat-icon>
              Annuler
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Completed Requests -->
    <mat-tab label="Terminées">
      <ng-template mat-tab-label>
        Terminées
        <span class="badge" *ngIf="completedRequests.length > 0">({{ completedRequests.length }})</span>
      </ng-template>
      <div class="requests-grid">
        <mat-card *ngFor="let request of completedRequests" class="request-card">
          <mat-card-header>
            <mat-icon mat-card-avatar [color]="request.status === 'completed' ? 'primary' : 'warn'">
              {{ request.status === 'completed' ? 'check_circle' : 'cancel' }}
            </mat-icon>
            <mat-card-title>{{ request.patientName }}</mat-card-title>
            <mat-card-subtitle>{{ request.specialty }}</mat-card-subtitle>
            <div class="card-actions">
              <mat-chip [color]="getStatusColor(request.status)" selected>
                {{ getStatusLabel(request.status) }}
              </mat-chip>
            </div>
          </mat-card-header>
          
          <mat-card-content>
            <div class="request-info">
              <div class="info-row">
                <mat-icon>schedule</mat-icon>
                <span>{{ formatDateTime(request.requestDate) }}</span>
              </div>
              
              <div class="info-row" *ngIf="request.responseDate">
                <mat-icon>done</mat-icon>
                <span>Réponse: {{ formatDateTime(request.responseDate) }}</span>
              </div>
              
              <div class="info-row" *ngIf="request.expertName">
                <mat-icon>person</mat-icon>
                <span>{{ request.expertName }}</span>
              </div>
              
              <div class="summary">
                <p>{{ request.summary }}</p>
              </div>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-raised-button color="primary" (click)="viewResponse(request)" 
                    *ngIf="request.status === 'completed'">
              <mat-icon>visibility</mat-icon>
              Voir la réponse
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
</div>