<div class="page-header">
  <div class="container">
    <h1>Suivi des prises</h1>
    <p>Enregistrement des prises médicamenteuses</p>
  </div>
</div>

<div class="container">
  <!-- Today's Schedule -->
  <mat-card class="schedule-card">
    <mat-card-header>
      <mat-card-title>Prises d'aujourd'hui</mat-card-title>
      <mat-card-subtitle>{{ new Date() | date:'fullDate':'':'fr' }}</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="intake-list">
        <div *ngFor="let intake of todayIntakes" class="intake-item" 
             [class.overdue]="intake.status === 'scheduled' && isOverdue(intake.scheduledTime)">
          
          <div class="intake-info">
            <div class="medication-details">
              <h3>{{ intake.medicationName }}</h3>
              <p>{{ intake.dosage }}</p>
            </div>
            
            <div class="time-info">
              <div class="scheduled-time">
                <mat-icon>schedule</mat-icon>
                <span>{{ intake.scheduledTime }}</span>
              </div>
              <div class="actual-time" *ngIf="intake.actualTime">
                <mat-icon>check</mat-icon>
                <span>Pris à {{ intake.actualTime }}</span>
              </div>
            </div>
          </div>
          
          <div class="intake-status">
            <mat-chip [color]="getStatusColor(intake.status)" selected>
              <mat-icon>{{ getStatusIcon(intake.status) }}</mat-icon>
              {{ getStatusLabel(intake.status) }}
            </mat-chip>
          </div>
          
          <div class="intake-actions" *ngIf="intake.status === 'scheduled'">
            <button mat-raised-button color="primary" (click)="recordIntake(intake)">
              <mat-icon>check_circle</mat-icon>
              Prise effectuée
            </button>
            
            <button mat-button color="warn" (click)="markAsMissed(intake)">
              <mat-icon>cancel</mat-icon>
              Manquée
            </button>
          </div>
          
          <div class="intake-notes" *ngIf="intake.notes">
            <mat-icon>note</mat-icon>
            <span>{{ intake.notes }}</span>
          </div>
          
          <div class="side-effects" *ngIf="intake.sideEffects">
            <mat-icon>warning</mat-icon>
            <span>Effets secondaires: {{ intake.sideEffects }}</span>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Quick Record Form -->
  <mat-card class="quick-record-card">
    <mat-card-header>
      <mat-card-title>Enregistrement rapide</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="intakeForm" class="quick-form">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Médicament</mat-label>
            <mat-select formControlName="medicationId">
              <mat-option *ngFor="let intake of todayIntakes" [value]="intake.id">
                {{ intake.medicationName }} - {{ intake.dosage }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Heure de prise</mat-label>
            <input matInput type="time" formControlName="actualTime">
          </mat-form-field>
        </div>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Notes (optionnel)</mat-label>
          <textarea matInput formControlName="notes" rows="2"></textarea>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Effets secondaires (optionnel)</mat-label>
          <textarea matInput formControlName="sideEffects" rows="2"></textarea>
        </mat-form-field>
        
        <div class="form-actions">
          <button mat-raised-button color="primary" [disabled]="intakeForm.invalid">
            <mat-icon>save</mat-icon>
            Enregistrer
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
</div>